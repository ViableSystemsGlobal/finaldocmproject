#!/bin/bash

# Emergency Malware Detection and Remediation Script
# Run this on your VPS immediately

echo "üîç Checking for malicious processes..."
echo "======================================"

# Check CPU usage
echo ""
echo "üìä Top CPU-consuming processes:"
ps aux --sort=-%cpu | head -20

echo ""
echo "üìä Processes by CPU usage:"
top -bn1 | head -20

echo ""
echo "üîç Checking for suspicious processes:"
echo "Looking for processes with 'next' in name..."
ps aux | grep -i next | grep -v grep

echo ""
echo "üîç Checking Docker containers:"
docker ps --format "table {{.ID}}\t{{.Names}}\t{{.Status}}\t{{.CPU}}"

echo ""
echo "üîç Checking for cryptominers (common names):"
ps aux | grep -E "(xmrig|minerd|cpuminer|stratum|mining|monero)" | grep -v grep

echo ""
echo "üîç Network connections:"
netstat -tulpn | grep -E "(ESTABLISHED|LISTEN)" | head -20

echo ""
echo "üîç Checking for suspicious files in .local/share/next:"
find /var/lib/docker -name "next" -type f 2>/dev/null | head -10

echo ""
echo "üîç File details of detected 'next' files:"
find /var/lib/docker -path "*/.local/share/next" -type f 2>/dev/null -exec ls -lah {} \; | head -10

echo ""
echo "‚ö†Ô∏è  If you see high CPU usage, run:"
echo "   docker ps -a"
echo "   docker stats"
echo "   docker exec <container-id> ps aux"

